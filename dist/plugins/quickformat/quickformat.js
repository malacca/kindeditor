KindEditor.plugin("quickformat",function(e){var t=this,n="quickformat",r=t.lang(n+"."),a=e.IE&&e.V<9;function i(e,t){return e.hasAttribute?e.hasAttribute(t):!!e[t]}function u(e){for(;e.attributes.length>0;)e.removeAttribute(e.attributes[0].name);return e}function c(e,t){var n,r,a=[];for(r=0;r<e.length;r++)a.push(e[r]);for(;n=a.shift();)t.call(n,n)}function o(n,r){var o=t.edit.win,l=t.edit.doc,s=l.body,f="##___keQuick___##".length,g={},d=function(e,t){var n,r,a,i,u=l.getElementsByTagName(e);u.length&&(e in g||(g[e]=[]),r=(n=u[0]).parentNode,a=t.call(n,n),(i=document.createElement("p")).innerHTML="##___keQuick___##"+e+"_"+g[e].length,r.insertBefore(i,n),r.removeChild(n),g[e].push(a),d(e,t))},m=function(e){if("##___keQuick___##"===e.substr(0,f)){var t=e.substr(f).split("_"),n=t[0],r=parseInt(t[1]);if(g[n]&&g[n][r])return g[n][r]}},p=o.getSelection&&void 0!==l.createRange,h=!p&&void 0!==l.selection&&void 0!==s.createTextRange;d("img",function(e){return i(e,"data-ke-name")?'<a name="'+unescape(e.getAttribute("data-ke-name"))+'"></a>':i(e,"data-ke-tag")?unescape(e.getAttribute("data-ke-tag")):i(e,"src")?"<p"+(r?' align="center"':"")+'><img src="'+e.getAttribute("src")+'"/></p>':""}),d("pre",function(e){return e.getAttribute("contenteditable")?e.outerHTML:"<pre>"+function(e){if(p){e.setAttribute("contenteditable",!0);var t=o.getSelection();t.selectAllChildren(e);var n=""+t;return t.removeAllRanges(),n}if(h){var r=s.createTextRange();return r.moveToElementText(e),r.text}return e.innerText}(e)+"</pre>"}),d("table",function(t){return c(t.getElementsByTagName("tr"),u),c(t.getElementsByTagName("th"),u),c(t.getElementsByTagName("td"),function(e){if(a?function(e){for(var t,n=[],r=0;r<e.attributes.length;r++)"rowspan"!==(t=e.attributes[r].name.toLowerCase())&&"rowspan"!==t&&n.push(t);for(;t=n.shift();)e.removeAttribute(t)}(e):u(e),!e.getElementsByTagName("table").length){var t=e.innerText.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");if(""===t)e.innerHTML="&nbsp;";else{var n=m(t);e.innerHTML=n||t}}}),e(u(t)).attr({style:"width:100%",cellpadding:2,cellspacing:0,border:1}),t.outerHTML+"<br/>"}),d("hr",function(e){return e.className.indexOf("ke-pagebreak")>-1?e.outerHTML:""});var b=s.innerHTML,v=[];return e.each(b.replace(/<[^>].*?>/g,"\n").split("\n"),function(e,t){if(""!==(t=t.replace(/^(?:&nbsp;|[\s\uFEFF\xA0])+|(?:&nbsp;|\s+|\uFEFF|\xA0)+$/g,""))){var r=m(t);r?v.push(r):v.push("<p>"+(n?"　　":"")+t+"</p>")}}),v.join("")}t.clickToolbar(n,function(){var a=t.createMenu({name:n,width:180});e.each(r,function(e,n){a.addItem({title:n,checked:!1,click:function(){t.hideMenu(),function(e){var n;if("unlink"===e)n=(n=t.html()).replace(/<a.*?>(.*)<\/a>/gi,"$1");else{var r=e.indexOf("center")>-1;n=o(e.indexOf("Indent")>-1,r)}t.html(n),t.cmd.selection(!0),t.addBookmark()}(e)}})}),a.autoLeft()})});