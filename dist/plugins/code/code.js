KindEditor.plugin("code",function(e){var t,a=this,n="code",i=a.lang(n),r=a.lang(n+"."),c={js:"JavaScript",html:"HTML",css:"CSS",php:"PHP",perl:"Perl",python:"Python",ruby:"Ruby",java:"Java",vb:"ASP/VB",cpp:"C/C++",cs:"C#",xml:"XML",bsh:"Shell",code:"Other"},l='<div style="padding:10px 20px;"><div class="ke-dialog-row"><select class="ke-code-type">',o=e.IE&&e.V<9;for(var s in c)l+='<option value="'+s+'">'+c[s]+"</option>";function d(t){var c=a.createDialog({name:n,width:800,title:i,body:l,yesBtn:{name:a.lang("yes"),click:function(n){var i=e(".ke-code-type",c.div).val(),l=s.val(),d="prettyprint"+(""===i?"":" lang-"+i);if(""===e.trim(l))return alert(r.pleaseInput),void s[0].focus();l=e.escape(l),t?(t[0].className=d,t.html(o?'<span class="prettyprint_ie">'+l+"</span>":l)):a.insertHtml('<pre class="'+d+'" contenteditable="false">\n'+l+"</pre> "),a.hideDialog().focus()}}}),s=e("textarea",c.div);t&&s.val(t.text()),s[0].focus()}function p(t){var a=e(t.target);return"pre"===a.name&&a.hasClass("prettyprint")?a:null}function u(e){return!!(t=p(e))}function v(){var t=e.iframeDoc(a.edit.iframe);e(t).dblclick(function(e){var t=p(e);t&&(e.preventDefault(),d(t))})}l+='</select></div><textarea class="ke-textarea ke-textarea-code" style="width:100%;height:540px;"></textarea></div>',a.clickToolbar(n,function(){d()}),a.addContextmenu({title:r.edit,cond:u,width:150,iconClass:"ke-icon-code",click:function(){d(t),a.hideMenu()}}).addContextmenu({title:r.remove,cond:u,width:150,click:function(){a.hideMenu(),t.remove(),a.addBookmark(),t=null}}),o?a.beforeGetHtml(function(e){return e.replace(/<span[^>]*class="?prettyprint_ie"?[^>]*>([\s\S]*?)<\/span>/gi,function(e,t){return t})}):e.IE||(a.isCreated?v():a.afterCreate(v))});