KindEditor.plugin("filemanager",function(e){var i=this,n="filemanager",a=e.undef(i.fileManagerJson,i.basePath+"php/file_manager_json.php"),l=i.lang(n+".");function t(e,i){var n,a,l;i.is_dir?e.attr("title",i.filename):e.attr("title",(n=i.filename,a=i.filesize,l=i.datetime,n+" ("+a+", "+l+")"))}function o(e,i){var n=i?80:14;return'<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="'+n+'" height="'+n+'"><path d="'+(e?"M927.744 210.944h-384l-32.256-46.08c-32.768-60.928-41.472-92.16-92.16-92.16H96.256c-51.2 0-92.672 41.472-92.672 92.16v693.248c0 51.2 41.472 92.672 92.672 92.672h832c51.2 0 92.672-41.472 92.672-92.672V303.104c-.512-50.688-41.984-92.16-93.184-92.16m0 0z":"M658.286 292.571V22.857q12.571 8 20.571 16L912 272q8 8 16 20.571H658.286zm-73.143 18.286q0 22.857 16 38.857t38.857 16h310.857v603.429q0 22.857-16 38.857T896 1024H128q-22.857 0-38.857-16t-16-38.857V54.857q0-22.857 16-38.857T128 0h457.143v310.857z")+'"/></svg>'}function r(i,n){if(n.is_dir)return o(!0,!0);var a=n.filetype||n.filename.split(".").pop();return e.inArray(a,["png","jpg","gif","jpeg"])<0?o(!1,!0):'<img src="'+e.formatUrl(i.current_url+n.filename,"absolute")+'"/>'}i.plugin.filemanagerDialog=function(d){var s=e.undef(d.width,650),c=e.undef(d.dirName,""),p=e.undef(d.viewType,"VIEW").toUpperCase(),u=d.clickFn,v='<div class="ke-plugin-filemanager"><div class="ke-header ke-plugin-filemanager-header"><div class="ke-left"><a class="ke-inline-block" name="moveupLink" href="javascript:;">'+l.moveup+'</a></div><div class="ke-right"> '+l.viewType+' <select class="ke-inline-block" name="viewType"><option value="VIEW">'+l.viewImage+'</option><option value="LIST">'+l.listImage+"</option></select>\t "+l.orderType+'<select class="ke-inline-block" name="orderType"><option value="NAME">'+l.fileName+'</option><option value="SIZE">'+l.fileSize+'</option><option value="TYPE">'+l.fileType+'</option></select></div><div class="ke-clearfix"></div></div><div class="ke-plugin-filemanager-body"></div></div>',m=i.createDialog({name:n,width:s,title:i.lang(n),body:v}),f=m.div,g=e('[name="moveupLink"]',f),h=e('[name="viewType"]',f),k=e('[name="orderType"]',f),_=e(".ke-plugin-filemanager-body",f);function b(n,l,t){var o="path="+n+"&order="+l+"&dir="+c;m.showLoading(i.lang("ajaxLoading")),e.ajax(e.addParam(a,o+"&"+(new Date).getTime()),function(e){m.hideLoading(),t(e)})}var w=[];function T(i,n,a,l){var t=e.formatUrl(n.current_url+a.filename,"absolute"),o=encodeURIComponent(n.current_dir_path+a.filename+"/");a.is_dir?i.click(function(e){b(o,k.val(),l)}):i.click(function(e){u.call(this,t,a.filename)}),w.push(i)}function y(i,n){function a(){"VIEW"==h.val()?b(i.current_dir_path,k.val(),E):b(i.current_dir_path,k.val(),C)}e.each(w,function(){this.unbind()}),g.unbind(),h.unbind(),k.unbind(),i.current_dir_path&&g.click(function(e){b(i.moveup_dir_path,k.val(),n)}),h.change(a),k.change(a),_.html("")}function C(i){y(i,C);var n=document.createElement("table");n.className="ke-table",n.cellPadding=0,n.cellSpacing=0,n.border=0,_.append(n);for(var a=i.file_list,l=0,t=a.length;l<t;l++){var r=a[l],d=e(n.insertRow(l));d.mouseover(function(i){e(this).addClass("ke-on")}).mouseout(function(i){e(this).removeClass("ke-on")});var s=o(r.is_dir,!1);T(e(d[0].insertCell(0)).addClass("ke-cell ke-name").append(s).append(document.createTextNode(" "+r.filename)).attr("title",r.filename),i,r,C),e(d[0].insertCell(1)).addClass("ke-cell ke-size").html(r.is_dir?"-":r.filesize),e(d[0].insertCell(2)).addClass("ke-cell ke-datetime").html(r.datetime)}}function E(i){y(i,E);for(var n=i.file_list,a=0,l=n.length;a<l;a++){var o=n[a],d=e('<div class="ke-inline-block ke-item"></div>'),s=e('<div class="ke-inline-block ke-photo"></div>').mouseover(function(i){e(this).addClass("ke-on")}).mouseout(function(i){e(this).removeClass("ke-on")});t(s,o),T(s,i,o,E),d.append(s.append(r(i,o))).append('<div class="ke-name" title="'+o.filename+'">'+o.filename+"</div>").appendTo(_)}}return h.val(p),b("",k.val(),"VIEW"==p?E:C),m}});